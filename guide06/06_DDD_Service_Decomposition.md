# Chapter 06: DDDによるサービス分割戦略

## 1. はじめに：マイクロサービス分割という難問

クラウドネイティブという強力な土台を手に入れた私たちは、次にコンポーザブル・バンキングの「レゴブロック」、すなわち**マイクロサービス**を構築するステップに進みます。しかし、ここで極めて重要かつ困難な問いに直面します。

**「どのように、サービスを分割すればよいのか？」**

技術的な観点だけで分割しようとすると、往々にして失敗します。例えば、「顧客データベース担当」「融資ロジック担当」のように分割すると、一つのビジネス要求（例：新規ローン申込）を実現するために、多数のサービスが互いに密に連携する必要が生まれ、結局はモノリシックシステムと同じ硬直性を生んでしまいます。これは**分散モノリス**と呼ばれる、最も避けたいアンチパターンです。

この難問に対する、最も強力な戦略的指針。それが**ドメイン駆動設計（Domain-Driven Design: DDD）**です。

## 2. ドメイン駆動設計（DDD）とは何か？

DDDとは、単純な技術論ではありません。**ソフトウェアの関心の中心を、テクノロジーから、そのソフトウェアが解決しようとしているビジネス課題そのもの（＝ドメイン）に置く**、設計思想であり、一連の戦略的・戦術的パターンの集合体です。

DDDの目的は、複雑なビジネスドメインを深く理解し、その構造をソフトウェアの構造に直接反映させることで、ビジネスの変化に強く、真に価値を生み出すソフトウェアを構築することにあります。

## 3. 戦略的設計：ビジネスに基づいた境界線

マイクロサービスの分割において特に重要となるのが、DDDの**戦略的設計**と呼ばれるパートです。

### ① 境界づけられたコンテキスト (Bounded Context)

これがDDDの最も核心的なコンセプトです。境界づけられたコンテキストとは、**特定のビジネスドメインにおける、明確な意味の境界**を定義するものです。

例えば、同じ「顧客」という言葉でも、
-   **マーケティング部門**では、「見込み顧客」や「キャンペーン対象者」として捉えられるかもしれません。
-   **融資審査部門**では、「申込者」や「連帯保証人」として、その信用情報が重視されます。
-   **資産運用部門**では、「投資家」として、そのリスク許容度が重要な関心事となります。

このように、部門や文脈（コンテキスト）が異なれば、同じ言葉でもその意味や関心事が微妙に、あるいは全く異なります。

DDDでは、この**意味の境界線**を明確に定義し、その境界の内側では、用語の定義が曖昧さなく一貫している状態を作ります。この境界こそが、マイクロサービスを分割するための、最も自然で強力な候補となります。つまり、**1つの境界づけられたコンテキストが、1つのマイクロサービスに対応する**のが理想的な形です。

### ② ユビキタス言語 (Ubiquitous Language)

各コンテキストの境界内部では、開発者とドメインエキスパート（銀行業務の専門家）が、**共通の言語（ユビキタス言語）**を使ってコミュニケーションします。

「申込者」「与信スコア」「実行金利」といったビジネスの現場で使われる言葉が、そのままコード上のクラス名、メソッド名、変数名として使われます。これにより、通訳の必要がなくなり、ビジネスルールがコードに正確に反映され、誤解に基づくバグが劇的に減少します。

## 4. ドメインの分類：どこに注力すべきか？

すべてのマイクロサービスが、同じ重要度を持つわけではありません。DDDは、ビジネスにおけるドメインの性質を分類し、どこに最も投資すべきかを判断するための指針も与えてくれます。

-   **コア・ドメイン (Core Domain)**
    -   **企業の競争優位性の源泉**となる、最も重要で複雑なビジネス領域。
    -   例：独自のアルゴリズムを用いた高度な**融資審査モデル**、パーソナライズされた**資産運用提案エンジン**など。
    -   ここには、最も優秀な人材を投入し、独自に開発すべきです。

-   **支援ドメイン (Supporting Subdomain)**
    -   コア・ドメインを支援するが、それ自体は競争優位性を持たないビジネス領域。
    -   例：顧客情報を管理するシステム、行員向けの業務レポート作成ツールなど。
    -   自社で開発することもありますが、必ずしも最新技術を投入する必要はありません。

-   **汎用ドメイン (Generic Subdomain)**
    -   ビジネスに不可欠だが、完全に一般的で、解決済みの問題領域。
    -   例：認証・認可システム、メール配信サービス、本人確認(KYC)サービスなど。
    -   これらは自社で開発すべきではありません。外部のパッケージ製品やSaaSを積極的に活用すべきです。

この分類により、限られた開発リソースを、真に価値を生み出す「コア・ドメイン」に集中させることが可能になります。

DDDは、単なる設計手法ではなく、ビジネスとテクノロジーが一体となって価値を創造するための、強力な羅針盤なのです。

次章では、DDDによって分割されたこれらのマイクロサービスが、どのように連携し、システム全体として機能するのか、そのためのアーキテクチャパターンについて見ていきます。 